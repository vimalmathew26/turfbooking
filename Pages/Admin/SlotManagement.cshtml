@page
@model turfbooking.Pages.Admin.SlotManagementModel
@using turfbooking.Models;

@{
   
    ViewData["Title"] = "Admin Slot Management";
}

<h2>Slot Management</h2>

<div class="row">
    <div class="col-md-3">
        <h4>Select Date</h4>
        <ul class="list-group">
            @foreach (var date in Model.SlotDates)
            {
                <li class="list-group-item">
                    <a asp-page="/Admin/SlotManagement" asp-route-SelectedDate="@date.ToString("yyyy-MM-dd")" asp-route-GroundID="@Model.GroundId">
                        @date.ToShortDateString()
                    </a>
                </li>
            }
        </ul>
    </div>

    <div class="col-md-9">
        @if (Model.Slots != null && Model.Slots.Any())
        {
            <h4>Slots for @Model.SelectedDate?.ToShortDateString()</h4>
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>Start</th>
                        <th>End</th>
                        <th>Ground</th>
                        <th>Status</th>
                        <th>Customer Name</th>
                        <th>Customer PhoneNo</th>
                        <th>Disable</th>
                        <th>Delete</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var slot in Model.Slots)
                    {
                        <tr>
                            <td>@slot.StartTime</td>
                            <td>@slot.EndTime</td>
                            <td>@slot.Ground.GroundName</td>
                            <td>
                                @if (slot.Status==Slot.SlotStatus.Booked)
                                {
                                    <span class="text-danger">Booked</span>
                                }
                                else if (slot.Status == Slot.SlotStatus.Available)
                                {
                                    <span class="text-success">Available</span>
                                }
                                else
                                {
                                    <span class="text-success">Blocked</span>
                                }
                            </td>

                            <td>
                                @if (slot.Status==Slot.SlotStatus.Booked && slot.Booking?.User != null)
                                {
                                    @slot.Booking.User.Username
                                }
                                else
                                {
                                    <span class="text-muted">-</span>
                                }
                            </td>
                            <td>
                                @if (slot.Status == Slot.SlotStatus.Booked && slot.Booking?.User != null)
                                {
                                    @slot.Booking.User.PhoneNumber
                                }
                                else
                                {
                                    <span class="text-muted">-</span>
                                }
                            </td>
                            <td>
                               
                                @if (slot.Status == Slot.SlotStatus.Available)
                                {
                                    <form method="post" asp-page-handler="Block" asp-route-id="@slot.Id" asp-route-groundId="@slot.GroundId" asp-route-selectedDate="@Model.SelectedDate?.ToString("yyyy-MM-dd")" style="display:inline;">
                                        <button type="submit" class="btn btn-warning">Disable</button>
                                    </form>
                                }
                                else if (slot.Status == Slot.SlotStatus.Blocked)
                                {
                                    <form method="post" asp-page-handler="Enable" asp-route-id="@slot.Id" asp-route-groundId="@slot.GroundId" asp-route-selectedDate="@Model.SelectedDate?.ToString("yyyy-MM-dd")"
                                          style="display:inline;">
                     
                                        <button type="submit" class="btn btn-success">Enable</button>
                                    </form>
                                }
                            </td>
                            <td>
                                <form method="post" asp-page-handler="Delete" asp-route-id="@slot.Id" asp-route-GroundId="@slot.GroundId" style="display:inline;">
                                    <button type="submit" class="btn btn-danger">Delete</button>
                                </form>
                                
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        }
        else
        {
            <div class="alert alert-warning text-center my-4"> No Slot For This Day</div>
        }
    </div>
</div>

